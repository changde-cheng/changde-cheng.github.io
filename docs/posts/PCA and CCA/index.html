<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Changde Cheng">
<meta name="dcterms.date" content="2022-10-18">
<meta name="description" content="Changdeâ€™s personal website.">

<title>Changde Cheng - What is canonical correlation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/academicons-1.9.2/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/academicons-1.9.2/size.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Changde Cheng</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../preprints.html">
 <span class="menu-text">Working Papers</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../featured.html">
 <span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html">
 <span class="menu-text">More Publications</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">Changde Cheng</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://scholar.google.com/citations?user=rUa7JoIAAAAJ&amp;hl=en">
 <span class="menu-text"><i class="ai  ai-google-scholar" title="" style="color:"></i></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/changde-cheng-15550215a/"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/changde-cheng"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">What is canonical correlation</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Changde Cheng </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 18, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-canonical-correlation" id="toc-what-is-canonical-correlation" class="nav-link active" data-scroll-target="#what-is-canonical-correlation">What is Canonical Correlation?</a></li>
  <li><a href="#connection-to-principal-angles" id="toc-connection-to-principal-angles" class="nav-link" data-scroll-target="#connection-to-principal-angles">Connection to Principal Angles</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>Canonical correlation provides a characterization of relations between two systems. Canonical correlation analysis works by identifying corresponding pairs of components that are highly correlated across systems.</p>
<p>Here is an example. Suppose we have RNA-seq results for a sample of patients, and we also measured their methylation profiles, say by EPIC-850k array. We want to know the relation between gene expression and methylation, which is very complicated given 50,000 genes and 800,000 probes. Canonical correlation analysis can be helpful to give us executive summary on the relation by reducing hundreds of thousands of genes and probes to a handful component pairs.</p>
<section id="what-is-canonical-correlation" class="level3">
<h3 class="anchored" data-anchor-id="what-is-canonical-correlation">What is Canonical Correlation?</h3>
<p>Given two random vectors <span class="math inline">\(\mathbf x\)</span> and <span class="math inline">\(\mathbf y\)</span>:</p>
<p><span class="math display">\[\mathbf{x} =
\begin{pmatrix}
x_1 \\
x_2 \\
\cdots \\
x_p
\end{pmatrix}, \qquad
\mathbf{y} =
\begin{pmatrix}
y_1 \\
y_2 \\
\cdots \\
y_q
\end{pmatrix}\]</span></p>
<p>Canonical variables are a pair of corresponding vectors <span class="math inline">\(\mathbf{a} \in R_p\)</span> and <span class="math inline">\(\mathbf{b} \in R_q\)</span> which maximize the correlation: <span id="eq-eq1"><span class="math display">\[\mathrm{cor}(\mathbf{a_1^T x},\mathbf{b_1^T y}) = \max_{\substack{\mathrm{var}(\mathbf{a^T x})=1 \\ \mathrm{var}(\mathbf{b^T y})=1}}{\mathrm{cor}(\mathbf{a^T x},\mathbf{b^T y})},
\tag{1}\]</span></span> where <span class="math inline">\(\mathbf{a_1^T x}\)</span> and <span class="math inline">\(\mathbf{b_1^T y}\)</span> are called the first pair of canonical variables. There can be more canonical variables out there that are not correlated with each other.</p>
<section id="canonical-variables-from-eigenvectors" class="level4">
<h4 class="anchored" data-anchor-id="canonical-variables-from-eigenvectors">Canonical variables from eigenvectors</h4>
<p>Consider the covariance matrix <span class="math inline">\(V\)</span> of the stacked random vector <span class="math inline">\(\pmatrix{\mathbf{x}\\ \mathbf{y}}\)</span>: <span id="eq-eq2"><span class="math display">\[V =
\begin{pmatrix}
\mathrm{var}(\mathbf{x}) &amp; \mathrm{cov}(\mathbf{x},\mathbf{y})\\
\mathrm{cov}(\mathbf{y},\mathbf{x}) &amp; \mathrm{var}(\mathbf{y})
\end{pmatrix}=
\begin{pmatrix}
V_{xx} &amp; V_{xy}\\
V_{yx} &amp; V_{yy}
\end{pmatrix} \tag{2}\]</span></span></p>
<p>The correlation to maximize in <a href="#eq-eq1">Equation&nbsp;1</a> is <span class="math display">\[\mathrm{cor}(\mathbf{a^T x},\mathbf{b^T y})=\frac{ \mathrm{cov}({\mathbf{a^T x},\mathbf{b^T y})} }{ \mathrm{var}(\mathbf{a^T x})^{\frac{1}{2}}~\mathrm{var}(\mathbf{b^T y})^{\frac{1}{2}} } = \mathrm{cov}({\mathbf{a^T x},\mathbf{b^T y})}=\mathbf{a^T} V_{xy} \mathbf{b},\]</span> as the variances of <span class="math inline">\(\mathbf{a^T x}\)</span> and <span class="math inline">\(\mathbf{b^T y}\)</span> are 1.</p>
<p>By the method of Lagrange multipliers, we set up a function: <span class="math display">\[\begin{align}
G &amp;= \mathrm{cov}(\mathbf{a^T x},\mathbf{b^T y}) - \frac{1}{2} \lambda_1 \left\{ \mathrm{var}(\mathbf{a^T x})-1 \right\} -  \frac{1}{2} \lambda_2 \left\{ \mathrm{var}(\mathbf{b^T y})-1 \right\} \\
&amp;= \mathbf{a^T} V_{xy} \mathbf{b} - \frac{1}{2} \lambda_1 \left\{ \mathbf{a^T} V_{xx} \mathbf{a} -1 \right\} -  \frac{1}{2} \lambda_2 \left\{ \mathbf{b^T} V_{yy} \mathbf{b} -1\right\}
\end{align}
\]</span></p>
<p>Let <span class="math display">\[\frac{\partial G}{\partial \mathbf{a}} = 0,\qquad \frac{\partial G}{\partial \mathbf{b}} = 0,\]</span> from which we reach a systems of linear equations: <span id="eq-eq3"><span class="math display">\[\begin{cases}
V_{xy} \mathbf{b} - \lambda_1 V_{xx} \mathbf{a} &amp;= 0,\\
V_{yx} \mathbf{a} - \lambda_2 V_{yy} \mathbf{b} &amp;= 0.
\end{cases} \tag{3}\]</span></span></p>
<p>From <a href="#eq-eq3">Equation&nbsp;3</a>, we get:</p>
<p><span id="eq-eq4"><span class="math display">\[\begin{cases}
\lambda_1  = \lambda_1 \mathbf{a^T} V_{xx} \mathbf{a} = \mathbf{a^T} V_{xy} \mathbf{b},\\
\lambda_2  = \lambda_2 \mathbf{b^T} V_{yy} \mathbf{b} = \mathbf{b^T} V_{yx} \mathbf{a} = \lambda_1^{\mathrm T} = \lambda_1.
\end{cases} \tag{4}\]</span></span></p>
<p>Therefore, <a href="#eq-eq3">Equation&nbsp;3</a> becomes: <span id="eq-eq5"><span class="math display">\[\begin{cases}
V_{xy} \mathbf{b} - \lambda V_{xx} \mathbf{a} &amp;= 0,\\
V_{yx} \mathbf{a} - \lambda V_{yy} \mathbf{b} &amp;= 0.
\end{cases} \tag{5}\]</span></span></p>
<p>Solve <span class="math inline">\(\mathbf{a}\)</span> from the first equation in <a href="#eq-eq5">Equation&nbsp;5</a> and substitute into the second equation in <a href="#eq-eq5">Equation&nbsp;5</a>. When <span class="math inline">\(\lambda \ne 0\)</span>, we have: <span class="math display">\[V_{yy}^{-1} V_{yx} V_{xx}^{-1} V_{xy} \mathbf{b} =  \lambda^2 \mathbf{b} \]</span> Therefor, <span class="math inline">\(\mathbf{b}\)</span> is an eigenvector of <span class="math inline">\(V_{yy}^{-1} V_{yx} V_{xx}^{-1} V_{xy}\)</span> and <span class="math inline">\(\lambda^2\)</span> its corresponding eigenvalue. Similarly, <span class="math inline">\(\mathbf{a}\)</span> is an eigenvector of <span class="math inline">\(V_{xx}^{-1} V_{xy} V_{yy}^{-1} V_{yx}\)</span> and <span class="math inline">\(\lambda^2\)</span> its corresponding eigenvalue. Note that <span class="math inline">\(\lambda = \mathrm{cor}(\mathbf{a^T x},\mathbf{b^T y})\)</span>, is a canonical correlation.</p>
</section>
</section>
<section id="connection-to-principal-angles" class="level3">
<h3 class="anchored" data-anchor-id="connection-to-principal-angles">Connection to Principal Angles</h3>
<p>The canonical correlation is equal to the cosine of principal angles, <span class="math inline">\(\theta_1, \theta_2, \cdots\)</span>, between two subspaces <span class="math inline">\(M(\mathbf{x})\)</span> and <span class="math inline">\(M(\mathbf{y})\)</span>, spanned by linear functions of <span class="math inline">\(\mathbf{x}\)</span> and <span class="math inline">\(\mathbf{y}\)</span>. The connection to cosine of principal angles is hinted by <a href="#eq-eq1">Equation&nbsp;1</a>: <span class="math display">\[\mathrm{cor}(\mathbf{a^T x},\mathbf{b^T y})=\frac{ \mathrm{cov}({\mathbf{a^T x},\mathbf{b^T y})} }{ \mathrm{var}(\mathbf{a^T x})^{\frac{1}{2}}~\mathrm{var}(\mathbf{b^T y})^{\frac{1}{2}} } = \frac{ \langle \mathbf{a^T x},\mathbf{b^T y} \rangle }{ \Vert \mathbf{a^T x}\Vert~\Vert \mathbf{b^T y}\Vert },\]</span></p>
<p>Recall that the cosines of principal angles between subspace <span class="math inline">\(M(\mathbf x)\)</span> and <span class="math inline">\(M(\mathbf y)\)</span>, with orthonormal bases <span class="math inline">\(\mathbf{x}\)</span> and <span class="math inline">\(\mathbf{y}\)</span> are singular values of the projection map <span class="math inline">\(\mathsf{Proj}: M(\mathbf x) \to M(\mathbf y)\)</span>. In other words, represent <span class="math inline">\(\mathsf{Proj}\)</span> by matrix <span class="math inline">\(P\)</span>, then we find the principal angles by singular value decomposition: <span class="math display">\[P=(\langle \mathbf{x}_i, \mathbf{y}_j \rangle)_{i,j} = U \Sigma V = U
\begin{pmatrix}\cos{\theta_1} &amp;  0 &amp;\cdots &amp; 0 \\
0 &amp; \cos{\theta_2} &amp;  \cdots &amp; 0 \\
\cdots &amp;  \cdots &amp; \cdots &amp;\cdots  \\
0 &amp;  0 &amp;\cdots &amp;  \cos{\theta_k}
\end{pmatrix}
V\]</span></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>